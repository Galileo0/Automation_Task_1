const a71_0x327e73=a71_0xbba1;function a71_0xbba1(_0x109450,_0x376265){const _0x5d824b=a71_0x5d82();return a71_0xbba1=function(_0xbba1f6,_0x496879){_0xbba1f6=_0xbba1f6-0x83;let _0x45a8ab=_0x5d824b[_0xbba1f6];return _0x45a8ab;},a71_0xbba1(_0x109450,_0x376265);}(function(_0x12392,_0x153db6){const _0x23191e=a71_0xbba1,_0x655fa6=_0x12392();while(!![]){try{const _0x4e4b5c=-parseInt(_0x23191e(0xa1))/0x1*(parseInt(_0x23191e(0xac))/0x2)+-parseInt(_0x23191e(0x9a))/0x3*(parseInt(_0x23191e(0xa5))/0x4)+parseInt(_0x23191e(0x92))/0x5+-parseInt(_0x23191e(0x9f))/0x6+parseInt(_0x23191e(0xb6))/0x7*(-parseInt(_0x23191e(0x9c))/0x8)+-parseInt(_0x23191e(0x8f))/0x9+-parseInt(_0x23191e(0x99))/0xa*(-parseInt(_0x23191e(0x97))/0xb);if(_0x4e4b5c===_0x153db6)break;else _0x655fa6['push'](_0x655fa6['shift']());}catch(_0x9e52d1){_0x655fa6['push'](_0x655fa6['shift']());}}}(a71_0x5d82,0xdc781));const fs=require('fs'),path=require(a71_0x327e73(0xc3)),os=require('os'),{spawn}=require(a71_0x327e73(0xc6)),helper=require(a71_0x327e73(0xc5)),logger=require(a71_0x327e73(0x94))['winstonLogger'],{logDir}=require(a71_0x327e73(0x94)),testHubConstants=require(a71_0x327e73(0xb1)),PercyBinary=require(a71_0x327e73(0xc0));function a71_0x5d82(){const _0x210943=['yxNWz','6244qfKlbl','app:exec','flags','vnJqO','close','healthcheck','projectName','51620PHkGgq','createPercyConfig','ENV_VAR','Percy\x20config\x20created\x20at\x20','automate','../../helpers/testhub/constants','MsrMF','exec:stop','stringify','debug','12475876SbOScM','qohMd','stdout','GgRCF','getBinaryPath','push','assign','percyOptions','kGXDj','&type=','./PercyBinary','percy/healthcheck','stop','path','fetchPercyToken','../helper','child_process','pipe','tmpdir','kCRGZ',':start','token','join','GNNgj','app','isProcessRunning','data','version','uZWoe','Percy\x20healthcheck\x20successful','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','vSiTh','percy.json','exports','writeFile','16072965BgjVaw','env','GET','8747200ptPSZP','JqzSO','../logger','GEnXP','CCVJd','63259262jVCCec','error','10GCbbJR','783lkDDAk','nodeRequest','8ccRgMW','createWriteStream','Error\x20creating\x20percy\x20config:\x20','9380742CPfAdF','start','41fuekhz','MFjzX','JjrMM'];a71_0x5d82=function(){return _0x210943;};return a71_0x5d82();}class Percy{#logfile=path['join'](logDir,'percy.log');#address=process[a71_0x327e73(0x90)]['PERCY_SERVER_ADDRESS']||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a71_0x327e73(0x85)]=![];constructor(_0x2c0daf){const _0x18d2e5=a71_0x327e73;this.#config=_0x2c0daf,!!_0x2c0daf[_0x18d2e5(0x84)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x17827b=a71_0x327e73;if(!this.#binaryPath){const _0xd5c100=new PercyBinary();this.#binaryPath=await _0xd5c100[_0x17827b(0xba)](this.#config);}return this.#binaryPath;}async #sleep(_0x5b92e4){return new Promise(_0x3aa69b=>setTimeout(_0x3aa69b,_0x5b92e4));}async[a71_0x327e73(0xaa)](){const _0x47c7ed=a71_0x327e73,_0x40da45={};_0x40da45['GEnXP']=_0x47c7ed(0x91),_0x40da45[_0x47c7ed(0x88)]=_0x47c7ed(0xc1);const _0x3e49e2=_0x40da45;try{const _0x13d922=await helper[_0x47c7ed(0x9b)](_0x3e49e2[_0x47c7ed(0x95)],_0x3e49e2[_0x47c7ed(0x88)],null,null,this.#address);if(_0x13d922)return!![];}catch(_0x291dad){return![];}}async[a71_0x327e73(0xa0)](){const _0x23d5a9=a71_0x327e73,_0x677c25={'MFjzX':_0x23d5a9(0xa6),'jlvVV':'exec','GNNgj':function(_0x13c18d,_0x4d392c,_0x5071fd,_0x22c1df){return _0x13c18d(_0x4d392c,_0x5071fd,_0x22c1df);},'MUVUo':_0x23d5a9(0xa9),'MsrMF':_0x23d5a9(0x89)},_0x4316e0=await this.#getBinaryPath(),_0x5e8db4={};_0x5e8db4[_0x23d5a9(0xa7)]='a';const _0x1c42d8=fs[_0x23d5a9(0x9d)](this.#logfile,_0x5e8db4),_0x426c56=await this[_0x23d5a9(0xc4)](),_0x43c254=await this[_0x23d5a9(0xad)]();if(!_0x426c56)return![];const _0x4a5919=[(this.#isApp?_0x677c25[_0x23d5a9(0xa2)]:_0x677c25['jlvVV'])+_0x23d5a9(0xca)];_0x43c254&&_0x4a5919[_0x23d5a9(0xbb)]('-c',_0x43c254);this.#proc=_0x677c25[_0x23d5a9(0x83)](spawn,_0x4316e0,_0x4a5919,{'env':Object[_0x23d5a9(0xbc)](process['env'],{'PERCY_TOKEN':_0x426c56,'TH_BUILD_UUID':process[_0x23d5a9(0x90)][testHubConstants[_0x23d5a9(0xae)]['BROWSERSTACK_TESTHUB_UUID']]})}),this.#proc[_0x23d5a9(0xb8)][_0x23d5a9(0xc7)](_0x1c42d8),this.#proc['stderr'][_0x23d5a9(0xc7)](_0x1c42d8),this['isProcessRunning']=!![];var _0x643cbb=this;this.#proc['on'](_0x677c25['MUVUo'],function(_0x323d12){const _0x598c3d=_0x23d5a9;_0x643cbb[_0x598c3d(0x85)]=![];});do{const _0x388d11=await this['healthcheck']();if(_0x388d11)return logger[_0x23d5a9(0xb5)](_0x677c25[_0x23d5a9(0xb2)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a71_0x327e73(0xc2)](){const _0x59f5b9=a71_0x327e73,_0x14e8c8={'kGXDj':function(_0x2888cb,_0x121f59){return _0x2888cb(_0x121f59);},'JjrMM':function(_0x1e84bf,_0x3c1aa7,_0x1f0e10){return _0x1e84bf(_0x3c1aa7,_0x1f0e10);},'vSiTh':_0x59f5b9(0xb3),'vnJqO':'close'},_0x514ef3=await this.#getBinaryPath();return new Promise((_0x2490ad,_0x357205)=>{const _0x3b3b2c=_0x59f5b9,_0x1bd99c={'OpagY':function(_0x59fb8f,_0x321101){const _0x2472ac=a71_0xbba1;return _0x14e8c8[_0x2472ac(0xbe)](_0x59fb8f,_0x321101);}},_0x512db8=_0x14e8c8[_0x3b3b2c(0xa3)](spawn,_0x514ef3,[_0x14e8c8[_0x3b3b2c(0x8b)]]);_0x512db8['on'](_0x14e8c8[_0x3b3b2c(0xa8)],_0x54b454=>{const _0x418907=_0x3b3b2c;this[_0x418907(0x85)]=![],_0x1bd99c['OpagY'](_0x2490ad,_0x54b454);});});}['isRunning'](){const _0x181931=a71_0x327e73;return this[_0x181931(0x85)];}async['fetchPercyToken'](){const _0x301ba3=a71_0x327e73,_0x2f3699={};_0x2f3699['enzJy']='app',_0x2f3699['kCRGZ']=_0x301ba3(0xb0),_0x2f3699['GgRCF']=_0x301ba3(0x91),_0x2f3699[_0x301ba3(0xb7)]='Percy\x20fetch\x20token\x20success';const _0x205d1e=_0x2f3699,_0x22e89e=this.#config[_0x301ba3(0xab)];try{const _0x2ccc54=this.#isApp?_0x205d1e['enzJy']:_0x205d1e[_0x301ba3(0xc9)],_0x4a9b31=await helper[_0x301ba3(0x9b)](_0x205d1e[_0x301ba3(0xb9)],'api/app_percy/get_project_token?name='+_0x22e89e+_0x301ba3(0xbf)+_0x2ccc54,{},this.#config),_0x24665b=_0x4a9b31[_0x301ba3(0x86)];return logger[_0x301ba3(0xb5)](_0x205d1e[_0x301ba3(0xb7)]),_0x24665b[_0x301ba3(0xcb)];}catch(_0x38a72c){return logger[_0x301ba3(0x98)](_0x301ba3(0x8a)+_0x38a72c),null;}}async[a71_0x327e73(0xad)](){const _0x3a5aed=a71_0x327e73,_0x2682b6={'BViFH':function(_0x1a20db,_0x33c276){return _0x1a20db(_0x33c276);},'lOGmw':function(_0x2e1e7f,_0x1aede8){return _0x2e1e7f+_0x1aede8;},'MSVCV':_0x3a5aed(0xaf),'JqzSO':_0x3a5aed(0x8c)};if(!this.#config[_0x3a5aed(0xbd)])return null;const _0x2d8e1b=path[_0x3a5aed(0xcc)](os[_0x3a5aed(0xc8)](),_0x2682b6[_0x3a5aed(0x93)]),_0x390af9=this.#config['percyOptions'];return!_0x390af9[_0x3a5aed(0x87)]&&(_0x390af9[_0x3a5aed(0x87)]='2'),new Promise((_0x199df8,_0x4cb8d1)=>{const _0x2555c1=_0x3a5aed,_0x5a1a6c={'CCVJd':function(_0x365a4d,_0x3a8274){return _0x2682b6['BViFH'](_0x365a4d,_0x3a8274);},'yxNWz':function(_0x21ce96,_0x464647){return _0x2682b6['lOGmw'](_0x21ce96,_0x464647);},'StHxi':_0x2682b6['MSVCV']};fs[_0x2555c1(0x8e)](_0x2d8e1b,JSON[_0x2555c1(0xb4)](_0x390af9),_0x18cf2e=>{const _0x15d93a=_0x2555c1;_0x18cf2e&&(logger[_0x15d93a(0x98)](_0x15d93a(0x9e)+_0x18cf2e),_0x5a1a6c[_0x15d93a(0x96)](_0x199df8,null)),logger[_0x15d93a(0xb5)](_0x5a1a6c[_0x15d93a(0xa4)](_0x5a1a6c['StHxi'],_0x2d8e1b)),_0x5a1a6c[_0x15d93a(0x96)](_0x199df8,_0x2d8e1b);});});}}module[a71_0x327e73(0x8d)]=Percy;